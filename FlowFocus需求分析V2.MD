# FlowFocus 产品需求文档 (PRD)

## 版本信息
- **版本号**: v2.0
- **发布日期**: 2025年9月

---

# 1. 应用目标

在FlowFocus 1.0的基础之上，帮助互联网用户高效存储多维表格配置、大模型配置和网上改写记录相关数据。存储方式为当今流行的飞书多维数据表格，钉钉多维数据表格和企业微信智能表格。

# 2. 应用形式

1. **Chrome浏览器侧边栏插件**：以侧边栏形式集成到Chrome浏览器中
2. **插件标识**：图标和名称与功能相符，符合Chrome插件规范
3. **技术规范**：代码完全符合Chrome插件开发规范，可在Chrome浏览器中正常运行

# 3. 应用功能概述

## 3.1 核心功能
1. **网页内容改写**：基于AI的文本改写、结果存储和同步。
2. **大模型配置管理**：支持Qwen、DeepSeek大模型的配置、测试、管理和同步。
3. **多维表格配置管理**：飞书多维数据表格、钉钉多维数据表格或企业微信智能表格的配置、测试、管理和同步。
4. **网页内容改写记录存储**：基于用户操作记录，将网页内容改写记录存储到本地或同步到指定的飞书多维数据表格、钉钉多维数据表格或企业微信智能表格中。


# 4. 应用功能详述及UI

## 4.1 插件整体架构

```
浏览器界面
└── 侧边栏面板 (Sidebar)
    ├── 功能切换区域
        ├── 多维表格配置标签页         
        ├── 大模型配置标签页            
        └── 改写功能标签页
```

## 4.2 Sidebar侧边栏界面

### 4.2.1 功能切换区域

点击配置切换区域的标签可以切换到不同配置的详细操作页面。

```
┌── ──── ─────┐ ┌───── ─────┐ ┌─────────┐
│ 多维表格配置 │ │ 大模型配置 │ │ 改写功能 │
└── ──── ─────┘ └────── ────┘ └─────────┘
```

#### 4.2.1.1 多维表格配置标签页

**功能说明**：
- 支持三种主流多维表格：飞书多维数据表格、钉钉多维数据表格、企业微信智能表格
- 提供完整的配置管理功能：增加、删除、编辑、测试连接

**配置项说明**：
1. **配置名称**：唯一标识，不可重名
2. **选择多维表格类型**：支持飞书多维数据表格、钉钉多维数据表格、企业微信智能表格 3种选择
3. **应用ID：**：在飞书、钉钉或企业微信开放平台创建的应用ID
4. **应用密钥**：用户在飞书、钉钉或企业微信开放平台获取的个人访问令牌，需要加密存储
5. **表格Token**：飞书、钉钉或企业微信开放平台多维表格应用的唯一标识
6. **操作功能**：
   - 保存配置：支持新增和覆盖
   - 测试连接：验证配置有效性
   - 编辑配置：修改已有配置
   - 删除配置：单条或批量删除
   - 查询配置：提供多维表格配置查询列表

**UI布局**：
```
┌─────────────────────────────────────────────┐
│ 多维表格配置                                 │
├─────────────────────────────────────────────┤
│ 配置名称：多维表格配置001                     │
├─────────────────────────────────────────────┤
│ 选择多维表格类型: [飞书|钉钉|企微] ▼           │
├─────────────────────────────────────────────┤
│ 应用ID: [输入框]                             │
│ 应用密钥: [输入框 (密码类型)]                 │
│ 多维表格Token: [输入框]                      │
│ [保存配置] [测试连接]                        │
└─────────────────────────────────────────────┘

┌─────────────────────────────────────────────┐
│ [☐ 全部] 多维表格历史配置 [批量同步] [批量删除]│
├─────────────────────────────────────────────┤
│ ☐ 多维表格配置001        [编辑] [同步] [删除] │
└─────────────────────────────────────────────┘
│ ☐ 多维表格配置002        [编辑] [同步] [删除] │
└─────────────────────────────────────────────┘
```

**UI详细说明**：
1. 配置名称：不可重名，唯一的标识一个多维表格配置信息，默认显示最近一次配置名称
2. 应用ID：在飞书、钉钉或企业微信开放平台创建的应用ID
3. 应用密钥：用户在飞书、钉钉或企业微信开放平台获取的个人访问令牌，需要加密存储
4. 多维表格Token：飞书、钉钉或企业微信开放平台多维表格应用的唯一标识
5. 保存配置：保存用户输入的配置信息（如果配置名称重复，则覆盖同名的配置信息，给用户提示是否覆盖；如果配置名称不存在，则创建新的配置信息）
6. 测试连接：验证配置是否正确，能否连接到飞书、钉钉或企业微信多维表格
7. 多维表格历史配置：显示所有保存的飞书、钉钉或企业微信多维表格配置信息
8. 删除配置：删除用户选择的飞书、钉钉或企业微信多维表格配置信息
9. 编辑配置：在多维表格配置区域中，显示用户选择的配置信息，并可以修改配置信息
10. 同步配置：将配置信息同步到飞书、钉钉或企业微信多维表格中
11. 选择全部前面的复选框，代表所有配置信息可以批量删除、同步到对应的多维表格中。
12. 每条配置前面也有复选框，选择多条记录的复选框，代表被选中的多条配置信息可以批量删除、同步到对应的多维表格中。

**同步配置**：
- 点击配置列表中的“同步”按钮，会弹出多维表格配置信息同步对话框：
┌─────────────────────────────────────────────┐
│ 多维表格配置信息同步设置                      │
├─────────────────────────────────────────────┤
│ 选中的同步记录数: 共 1 条                     │
├─────────────────────────────────────────────┤
│ 选中的记录配置名称:[当前选择的多维表格配置名称] │
├─────────────────────────────────────────────┤
│ 配置同步目的链接: [配置1|配置2|...] ▼          │
├─────────────────────────────────────────────┤
│ 配置同步目的表格: [表格名称]                  │
├─────────────────────────────────────────────┤
│                    [取消] [确定]             │
├─────────────────────────────────────────────┤
选中的同步记录数：是一个统计值，表示这次同步多维表格配置记录需的总数。
选中的记录配置名称：是当前选择的多维表格配置记录对应的名称集，选中多条记录时可以用逗号隔开不同记录对应的配置名称。
配置同步目的链接：是目前所有多维表格配置记录名称，可以下拉选择要用哪个记录的配置信息来连接多维表格，进行后续的同步。
配置同步目的表格：文本框，接受用户输入的多维表格名称，用来指定同步数据的目标表格。
点击“取消”按钮则放弃这次同步，点击“确定”按钮则同步当前选择的多维表格配置信息到对应的多维表格中。
对应的多维表格中必须有一个字段，名字是“数据集合”，用来存储同步过来的数据（就是本插件将多维表格配置信息打包好的json串，所以数据集合是文本类型）。



#### 4.2.1.2 大模型配置标签页

**功能说明**：
- 支持5种主流大模型：Qwen、DeepSeek、Volces、hunyuan和Kimi
- 提供完整的配置管理功能：增加、删除、编辑、测试连接

**配置项说明**：
1. **配置名称**：唯一标识，不可重名
2. **选择大模型**：支持Qwen、DeepSeek、Volces、hunyuan和Kimi 5种选择
3. **API Key**：对应平台的API密钥
4. **Base URL**：API调用地址，提供默认值
   - Qwen: 
      baseurl:`https://dashscope.aliyuncs.com/compatible-mode/v1`
      model：`qwen-turbo`
   - DeepSeek: 
      baseurl:`https://api.deepseek.com/v1`
      model：`deepseek-chat`
   - Volces: 
      baseurl:`https://ark.cn-beijing.volces.com/api/v3`
      model：``
   - Kimi: 
      baseurl:`https://api.moonshot.cn/v1`
      model：`moonshot-v1-8k`
   - hunyuan: 
      baseurl:`https://api.hunyuan.cloud.tencent.com/v1`
      model：`hunyuan-turbos-latest`
5. **模型端点**：具体使用的模型名称
6. **操作功能**：
   - 保存配置：支持新增和覆盖
   - 测试连接：验证配置有效性
   - 编辑配置：修改已有配置
   - 删除配置：单条或批量删除

**UI布局**：
```
┌──────────────────────────────────────────────────────┐
│ 大模型配置                                            │
├──────────────────────────────────────────────────────┤
│ 配置名称：[输入框]                                    │
├──────────────────────────────────────────────────────┤
│ 选择大模型: [Qwen|DeepSeek|Volces|hunyuan|Kimi] ▼     │
├──────────────────────────────────────────────────────┤
│ API Key: [密码输入框]                                │
│ Base URL: [URL输入框]                                │
│ 模型端点: [文本输入框]                                │
│ [保存配置] [测试连接]                                  │
└──────────────────────────────────────────────────────┘

┌──── ──── ────── ───── ──── ───── ───── ───── ──── ───┐
│ [☐ 全部] 大模型历史配置   [批量同步] [批量删除]         │
├──── ───── ────── ─────  ─── ───── ──── ───── ────────┤
│ ☐ Qwen配置001            [编辑] [同步] [删除]         │
└──── ───── ───── ────── ─── ───── ───── ───── ──── ───┘
│ ☐ DeepSeek配置001        [编辑] [同步] [删除]         │
└──── ───── ───── ────── ─── ──── ────── ────── ──── ──┘
```

**UI详细说明**：
1. 配置名称：不可重名，唯一的标识一个大模型配置信息，默认显示最近一次配置名称
2. 选择大模型：选择大模型厂商或品牌名称
3. API Key：将你在对应平台获取的密钥粘贴到输入框
4. Base URL：通常使用界面提供的默认值即可
5. 模型端点：用来指定要使用的具体大模型
6. 保存配置：保存用户输入的配置信息（如果配置名称重复，则覆盖同名的配置信息，给用户提示是否覆盖；如果配置名称不存在，则创建新的配置信息）
7. 测试连接：验证配置是否正确，能否连接到大模型
8. 大模型历史配置：显示所有保存的配置信息
9. 删除配置：删除用户选择的配置信息
10. 编辑配置：在大模型配置区域中，显示用户选择的配置信息，并可以修改配置信息
11. 选择全部前面的复选框，代表所有配置信息可以批量删除和同步。
12. 每条配置前面也有复选框，选择多条记录的复选框，代表被选中的配置信息可以批量删除和同步。
13. 每个配置后面有同步按钮，点击同步按钮可以将配置同步到对应的多维表格中。

**同步配置**：
- 点击配置列表中的“同步”按钮，会弹出大模型配置信息同步对话框：
┌─────────────────────────────────────────────┐
│ 大模型配置信息同步设置                        │
├─────────────────────────────────────────────┤
│ 选中的同步记录数: 共 1 条                     │
├─────────────────────────────────────────────┤
│ 选中的记录配置名称:[当前选择的大模型配置名称]   │
├─────────────────────────────────────────────┤
│ 配置同步目的链接: [配置1|配置2|...] ▼          │
├─────────────────────────────────────────────┤
│ 配置同步目的表格: [表格名称]                  │
├─────────────────────────────────────────────┤
│                    [取消] [确定]             │
├─────────────────────────────────────────────┤
选中的同步记录数：是一个统计值，表示这次同步大模型配置记录需的总数。
选中的记录配置名称：是当前选择的大模型配置记录对应的名称集，选中多条记录时可以用逗号隔开不同记录对应的配置名称。
配置同步目的链接：是目前所有多维表格配置记录名称，可以下拉选择要用哪个记录的配置信息来连接多维表格，进行后续的同步。
配置同步目的表格：文本框，接受用户输入的多维表格名称，用来指定同步数据的目标表格。
点击“取消”按钮则放弃这次同步，点击“确定”按钮则同步当前选择的大模型配置信息到对应的多维表格中。
对应的多维表格中必须有一个字段，名字是“数据集合”，用来存储同步过来的数据（就是本插件将大模型配置信息打包好的json串，所以数据集合是文本类型）。

#### 4.2.1.3 改写功能标签页

**功能说明**：
- 基于AI的文本改写功能
- 支持自定义改写提示词
- 改写结果管理功能

**操作流程**：
1. **文本获取**：
   - 在网页中选择文本
   - 点击"获取选中文字"按钮
   - 文本自动填入原文框

2. **改写设置**：
   - 输入改写工作名称（保存时建议填写，方便后续管理）
   - 在提示词框中描述改写要求
   - 可使用预设的改写模板

3. **改写执行**：
   - 点击"开始改写"按钮
   - 使用配置的AI模型进行改写
   - 结果显示在改写结果框

4. **结果管理**：
   - 复制原文/改写结果到剪贴板
   - 保存改写工作到本地存储
   - 编辑已保存的改写工作
   - 删除改写工作（单条或批量）


**UI布局**：
```
┌─────────────────────────────────────────────┐
│ 改写工作名称：[输入框]                       │
├─────────────────────────────────────────────┤
│ 网页原文                                    │
│ ┌─────────────────────────────────────────┐ │
│ │ [文本显示区域]                          │ │
│ └─────────────────────────────────────────┘ │
│ [获取选中文字] [📋 复制原文] [🗑️ 清空]       │
├─────────────────────────────────────────────┤
│ 改写设置                                    │
│ 大模型: [Qwen配置|DeepSeek配置|...] ▼        │
│ 改写提示词:                                 │
│ ┌─────────────────────────────────────────┐ │
│ │ 请将以下文本改写得更加正式和专业...      │ │
│ └─────────────────────────────────────────┘ │
│ [🔄 开始改写]                               │
├─────────────────────────────────────────────┤
│ 改写结果                                    │
│ ┌─────────────────────────────────────────┐ │
│ │ [改写结果显示区域]                      │ │
│ └─────────────────────────────────────────┘ │
│ [📋 复制改写结果] [保存]                    │
└─────────────────────────────────────────────┘

┌─────────────────────────────────────────────┐
│ [☐ 全部] 改写工作记录      [删除] [同步]      │
├─────────────────────────────────────────────┤
│ ☐ 改写工作001     [编辑] [删除] [同步]        │
│ ☐ 改写工作002     [编辑] [删除] [同步]        │
└─────────────────────────────────────────────┘
```

**UI详细说明**：
1. 改写工作名称：不可重名，唯一的标识一条改写工作记录。
2. 用户在浏览器中选择需要处理的文本。
3. 用户点击获取选中文字按钮，将选中的文本复制到插件中。
4. 用户根据需要填写大模型改写相关的提示词。
5. 用户点击"开始改写"按钮，改写结果将出现在改写结果文本框中。
6. 用户点击"清空"按钮，清空网页原文文本框中的内容。
7. 用户点击"复制原文"按钮，将网页原文复制到剪贴板中。
8. 用户点击"复制改写结果"按钮，将改写结果复制到剪贴板中。
9. 用户点击"保存"按钮，将改写结果保存到本地存储中。
10. 选择全部前面的复选框，代表所有改写工作记录可以批量删除和同步。
11. 每条改写工作记录前面也有复选框，选择多条记录的复选框，代表被选中的多条改写工作记录可以批量删除和同步。
12. 每条改写工作记录后面有同步按钮，点击同步按钮可以将改写工作记录同步到对应的多维表格中。


# 5. 技术架构

## 5.1 前端架构
- **框架**：原生JavaScript + HTML + CSS
- **构建工具**：Webpack
- **UI组件**：自定义组件库
- **状态管理**：本地存储 + 内存状态

## 5.2 后端服务
- **多维表格服务**：支持多种多维表格API调用
- **AI服务**：支持多种大模型API调用
- **存储服务**：Chrome Storage API

## 5.3 数据流
```
用户操作 → 前端界面 → 服务层 → API调用 → 数据存储
    ↓
结果反馈 ← 界面更新 ← 数据处理 ← API响应 ← 外部服务
```

# 6. 版本历史

## v2.0 (当前版本)
- ✅ 多维表格配置管理（飞书、钉钉、企业微信）
- ✅ 大模型配置管理（Qwen、DeepSeek、Volces、hunyuan、Kimi）
- ✅ 网页文本改写功能
- ✅ 连接测试功能
- ✅ 错误处理和调试信息
- ✅ 多维表格配置同步到多维表格（单条同步或批量同步）
- ✅ 大模型配置同步到多维表格（单条同步或批量同步）
- ✅ 改写结果同步到多维表格（单条同步或批量同步）


# 7. 使用说明

## 7.1 安装和配置
1. 在Chrome浏览器中加载插件
2. 配置至少一个大模型（推荐Qwen、DeepSeek、Volces、hunyuan、Kimi）
3. 测试大模型连接确保配置正确
4. 配置至少一个多维表格（飞书、钉钉、企业微信）
5. 测试多维表格连接确保配置正确

## 7.2 基本使用流程
1. 在网页中选择需要处理的文本
2. 打开插件侧边栏
3. 选择改写功能
4. 获取选中文字
5. 设置相关参数
6. 执行改写
7. 查看结果并进行后续操作
8. 选择改写工作记录，点击同步按钮，选择合适的多维表格工具，将改写工作记录同步到对应的多维表格中

## 7.3 数据管理
1. 所有多维表格配置、大模型配置和改写工作记录自动保存到本地
2. 支持多维表格配置、大模型配置和改写工作记录批量管理和操作
3. 提供多维表格配置、大模型配置和改写工作记录完整的编辑和删除功能
4. 提供提供多维表格配置、大模型配置和改写工作记录完整的查询功能

---

**文档维护**：本文档记录FlowFocus v2.0版本的完整功能实现情况，后续版本更新时需同步更新此文档。